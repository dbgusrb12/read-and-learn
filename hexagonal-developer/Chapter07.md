# 테스트

## 테스트 코드

### 자동화된 테스트•회귀 테스트•안정감

내가 수정한 코드가 어디에 어떤 영향을 끼칠지 모르기 때문에 기존 코드 수정은 두려운 일이다.

테스트를 수작업으로 진행하면 테스트를 아예 하지 않는 것보다는 낫지만 아무래도 다양한 경우의 수를 확인하기 어렵다.  
운이 좋아 버그가 빨리 발견되어 바로 대응할 수도 있지만, 한참 뒤에 발견되어 원인을 분석하는 데 어려움을 겪기도 한다.

이 때, 자동으로 실행할 수 있는 테스트 코드가 있다면 수정한 코드가 발생시키는 문제를 빨리 찾을 수 있다.  

테스트 커버리지가 높다고 해서 완벽하게 모든 문제를 없앨 수는 없지만,  
적어도 테스트를 통과한 코드는 문제가 없다는 것을 확신할 수 있다.  
그래서 테스트가 검증하는 범위, 즉 테스트 커버리지가 중요하다.

코드를 잘못 만지면 심각한 문제가 발생할 수도 있는 개발자는 항상 압박 속에 산다.  
이런 부담을 줄일 방법의 하나가 테스트 작성이다.  
테스트 코드가 검증하는 범위가 넓어질수록 내가 만든 코드가 문제를 일으키지 않는다는 확신이 커지고 코드를 수정할 때 안정감을 느끼게 된다.  
코드 변경에 대한 스트레스도 감소한다.

### 테스트 주도 개발과 회귀 테스트

TDD(Test-Driven Development)는 테스트 코드를 먼저 만드는 개발 방식이다.  
구현할 대상에 대한 테스트 코드를 먼저 만들고 테스트 코드를 통과시킬 만큼 구현을 진행한다.  
테스트를 통과하면 코드를 정리(리팩터링)한다.  
그다음 테스트 코드를 작성한다.  
TDD 는 이러한 과정을 개발이 완료될 때까지 반봅한다.

TDD 를 진행할 때 예외적인 상황에서의 테스트를 먼저 작성하고 그다음 정상적인 상황에서의 테스트를 작성하는 게 좋다.  
많은 기능은 정상적인 상황뿐 아니라 예외적인 상황에 대한 대처가 필요한데, TDD 는 테스트 코드를 작성할 때부터 이 점을 고려한다.

정상적인 상황과 예외적인 상황에 대한 테스트 코드를 작성하면 테스트가 다루는 커버리지가 높아진다.  

TDD 를 하면 회귀 테스트로 사용할 테스트 케이스가 증가하고 테스트 커버리지도 높아진다.  
테스트 커버리지가 높아지면 코드를 수정했을 때의 문제를 빠르게 발견할 수 있다.  
잘못 변경한 코드를 조기에 발견해서 조치하면 더 자신감있게 코드를 수정할 수 있게 된다.

### 테스트 주도 개발과 설계

TDD 는 기능을 설계하는 데 도움을 준다.  
테스트 코드에서 테스트할 대상의 기능을 실행하려면 다음과 같은 것을 정해야 한다.

- 클래스(타입) 이름
- 메서드 이름
- 메서드 파라미터 타입
- 리턴 타입, 익셉션 타입
- 의존 대상 • 역할

클래스 이름을 정하고 메서드 이름을 정하는 일은 기능을 설계하는 과정과 같다.  
클래스 • 메서드가 제공하는 기능이 이름에 잘 표현되어야 하는데 테스트 코드를 작성하려면 바로 클래스 • 메서드 이름부터 결정해야 한다.  

이름을 정한 뒤 기능을 실행하기 위한 파라미터로 어떤 타입을 사용해야 하는지를 결정한다.  
기존에 존재하지 않는 타입이면 타입 이름도 정해야 한다.  
기능을 실행한 뒤에 결과를 리턴한다면 리턴 타입을 결정해야 한다.

테스트 코드를 작성하고 테스트를 통과하려면 협업할 대상도 도출해야 한다.  

이렇듯 TDD 에서 테스트 코드 작성 과정은 설계와 밀접한 관련이 있다.  
일단 테스트할 대상의 이름, 메서드, 파라미터등을 결정해야 하고,  
테스트 대상이 직접 기능을 구현하는 것이 아니라 다른 타입에 구현을 미루는 형태로 역할을 분리하기도 한다.  
이러한 과정이 모두 설계에 해당한다.

### 테스트 주도 개발과 생산성

난생처음 테스트 코드를 작성하거나 아예 테스트 코드 작성 경험이 없는 개발자는 테스트 코드를 작성하는 자체가 생산성이 떨어지는 일이라고 느낄 수 있다.  
단편적인 면만 보면 사실이지만, 전체적인 개발 관점에서 바라보면 얘기가 달라진다.

개발자가 코드를 수정하면 테스트해야 한다.  
내가 만든 코드가 올바르게 동작하는지 수동으로 확인하는 과정이 한 번으로 끝나면 좋겠지만 로직이 복잡할수록 한 번에 완벽하게 구현하기란 쉽지 않다.  
코드를 수정해서 확인하고 잘못된 곳이 발견되면 또 코드를 수정해서 확인하는 과정을 반복적으로 거쳐야하고,  
다양한 예외 상황을 만들기 어렵기 때문에 개발 시간을 증가시킨다.

수동으로 테스트하려면 일단 필요한 코드를 다 만들어야 하고, 데이터 베이스등도 구동되어 있어햐 하기 때문에 시간이 오래 걸린다.  
실행 과정에서도 로직이 복잡할수록 한 곳이 아닌 여러 곳에 버그가 존재하기 때문에 에러가 발생하면 확인할 코드가 많다.
이럴 때마다 다시 많은 코드를 살펴봐야 하기 때문에 시간이 오래 걸리고 흐름 또한 깨지기 쉽다.

대부분 수동으로 테스트할 때는 데이터베이스와 외부 API 를 직접 연동하기 떄문에 원하는 상황을 만들려면 데이터베이스에 테스트를 위한 데이터를 구성해햐 한다.  
회부 API 를 사용할 때는 API 를 제공하는 업체에 연락해서 도움을 요청해야 한다.  
이런 번거로운 과정이 개발 시간을 증가시킬 뿐만 아니라 개발 자체를 힘겹게 만든다.

개발 시간은 코드를 작성하는 시간, 테스트하는 시간, 디버깅하는 시간으로 구성된다.  
개발 시간을 줄이려면 코딩하는 시간뿐 아니라 테스트 시간과 디버깅 시간을 줄여야 하는데 TDD 를 적용하면 테스트 시간과 디버깅 시간을 줄일 수 있다.  

테스트 시간을 줄이려면 테스트를 자동화해야한다.  
테스트를 자동화하기 위해서는 테스트를 코드 형태로 만들어 실행해야한다.  
TDD 는 처음부터 테스트 코드를 만들기 때문에 반복되는 테스트 시간을 줄여준다.  
처음에는 개발 시간이 늘어나는 것처럼 느껴지지만 시간이 갈수록 반복되는 테스트 시간을 줄여줘서 오히려 개발 시간이 줄어든다.  

코드를 작성한 시점과 테스트 시점 간의 차이가 벌어질수록 문제가 발생했을 때 원인을 찾는데 더 긴 시간이 걸린다.  
반면 TDD 는 기능을 구현하자마자 테스트를 실행하기 때문에 테스트를 실패해도 원인을 빨리 찾을 수 있고, 그만큼 디버깅 시간이 줄어든다.

TDD 는 리팩터링을 포함한다.  
리팩터링은 코드 구조와 가독성을 개선하는 작업이다.  
리팩터링으로 나중에 하게 될 코드 수정과 추가 작업을 쉽게 할 수 있게 된다.  
즉 미래의 디버깅 시간과 코딩 시간을 줄여준다.

TDD 를 진행하면 전체가 아닌 일부 코드만 검증할 수 있기 때문에 한 번에 하나만 집중해서 구현할 수 있게 도와준다.

## 테스트 가능성

모든 코드를 TDD 로 진행할 필요는 없다.  
개발을 먼저 하고 테스트 코드를 작성해도 괜찮다.  
적어도 테스트를 만들면 앞에서 언급한 많은 이점을 얻을 수 있다.  
테스트를 먼저 만들던, 나중에 만들던 중요한 것은 테스트 가능성을 높이는 데 있다.

코드를 만들 때 테스트 가능성을 염두에 두면 개발 생산성과 설계 품질을 높일 수 있다.

테스트 가능성을 높이기 위해 노력하자.  
테스트 가능성이 높아지면 외부 환경에 대한 의존이 줄어들어 전체가 아닌 일부만 빠르게 테스트할 수 있게 된다.  
테스트를 빠르게 할 수 있으니 개발 속도도 올라간다.  
테스트 가능성을 높이는 과정에서 자연스럽게 역할에 따라 타입이 분리되고, 응집도가 올라가고, 전반적인 설계 품질이 좋아진다.  
코드 응집도가 올려가면 향후에 코드를 변경하는 비용도 감소할 가능성이 커진다.  
코드 변경 비용 감소는 개발 생산성을 높여준다.

## 리팩터링을 위한 테스트 작성하기

리팩터링을 할 때 리팩터링 전과 후의 코드가 동일하게 동작하는지 보장할 수 있어야 한다.  
그러기 위해 리팩터링 전에 테스트 코드를 먼저 작성해야 한다.  
기존 코드에 테스트 코드를 먼저 만들고 그다음 리팩터링을 진행하면 리팩터링 후에 코드가 동일하게 동작하는지 검증할 수 있다.

테스트 코드 없이 기존 코드를 먼저 수정하면 부담이 커진다.  
하지만 일부 코드를 분리하고 테스트코드를 만들어낼 수 있다면 과감하게 시도할 필요가 있다.

코드가 복잡하게 얽혀있어 일부 코드를 분리하기 힘들때는 통합 테스트 작성을 시도하자.