# 코드 이해

## 코드 변경

개발자가 코드를 변경할 때 다음 2단계 과정을 거친다.

- 코드 이해
- 코드 수정

일반적으로 개발자가 코드를 이해하는 데 개발 시간의 60%를 쓴다고 한다.  
버그 수정과 같은 작업은 코드를 이해하는 데 90% 이상의 시간을 쏟기도 한다.  
이처럼 코드를 작성하는 시간보다 코드를 이해하는 시간이 더 소요되기 때문에  
기존 코드를 이해하는 작업은 유지보수하는데 매우 중요하다.

코드를 이해하는 시간을 줄이기 위해서는 2가지 역량이 요구된다.

- 코드를 제대로 이해할 수 있는 역량
- 이해하기 쉬운 코드를 작성하는 역량

이해하기 좋은 코드를 만들면 코드를 이해하는 데 들어가는 시간을 줄일 수 있으며 결과적으로 개발 시간도 줄어든다.

## 코드 이해 도구

코드 분석에 도움이 되는 다양한 수단이 존재한다.

### 코드 시각화

코드를 분석하고 그 결과를 그림으로 그리면 수정할 위치나 수정 영향을 받는 범위를 찾을 때 큰 도움이 된다.  
자신만의 표기법을 사용해도 되지만, 그렇게되면 다른 사람과의 의사소통에서 서로 다르게 해석 될 수 있는 여지가 있으니 UML 을 사용하는게 좋다.

### 코드 출력

분석하고 싶은 코드를 A3 용지 같은 큰 종이에 출력해서 관심 있는 코드를 형광펜으로 칠하고,  
영향을 주는 코드는 선을 긋는 등 코드를 직접 출력해서 보면 나중에 해당 출력물을 다시 볼 때  
기억을 되살리는 데 도움을 준다.

### 스크래치 리팩터링

스크래치 리팩터링은 코드 분석을 목적으로 하는 리팩터링이다.  
리팩터링을 하려면 코드 구조나 의미를 이해하는 과정을 거쳐야 하는데, 스크래치 리팩터링은 바로 여기에 집중한다.

스크래치 리팩터링은 코드 개선이 아닌 코드 이해가 목적이므로 결과는 반영하지 않고 다시 되돌린다.

### 함께 모여보기

코드를 함께 보면 다음과 같은 이점이 있다.

- 코드에 대한 지식이 여러 명에게 쌓인다.
- 서로의 지식을 주고받으며 부족한 부분을 채울 수 있다.
- 잘못 이해하는 것을 줄일 수 있다.

함께 모여서 코드를 볼 때는 2 ~ 4명 정도가 적당하다.  
참여 인원이 늘어나면 대화가 분산되면서 개개인의 집중력과 참여 적극성이 떨어질 수 있기 때문이다.

## 이해하기 좋은 코드

다양한 도구를 사용해서 코드를 이해하는 역량을 높이는 것은 코드 분석에 도움이 된다.  
하지만 이보다 더 중요한 것은 코드 자체를 이해하기 쉽게 만드는 것이다.

이해하기 좋은 코드를 만들 때 가장 염두에 두어야 하는 기본은 가독성이다.

### 이해를 돕는 몇 가지 코드 작성법

가독성 좋은 코드를 작성하기 위해 알고 있어야 하는 내용 몇가지

#### 이름

이름은 코드 가독성에 큰 영향을 준다.  
가독성이 좋은 코드를 작성하기 위한 출발점은 올바른 이름을 선택하는 것부터 시작된다.

의미나 의도 또는 목적을 유추할 수 있는 이름을 사용하자.  
표기한 이름이 실제 역할과 다르다면 코드를 분석할 때 많은 혼란을 준다.

#### 중첩 if 최소화

if 문이 중첩될수록 복잡도는 배가 된다.  
복잡한 if 문을 분석하려면 분기 조건과 같은 맥락을 기억해야 한다.

if 문이 중첩되어 코드가 복잡할 때는 if 조건을 역으로 바꿔 코드 구조를 단순화 할 수 있다.

```java
if (조건) {
    ...스크롤이 필요한 꽤 긴 코드
}
return;
```

위의 if 구조는 아래와 같이 변경 할 수 있다.

```java
if (!조건) {
    return;
}
...스크롤이 필요한 꽤 긴 코드
```

위의 코드의 경우, 조건을 충족하지 않을 때 아무것도 수행하지 않고 리턴한다는 것을 스크롤을 해야만 알 수 있는 반면,  
아래 코드의 경우, 스크롤하지 않아도 알 수 있다.

#### 변수 줄이기

변수 사용 범위는 최대한 좁게 한정하자.  
변수를 사용하는 범위가 넓어질수록 변수를 추적하기가 어려워진다.  
다음과 같은 규칙으로 적절한 변수 사용 범위를 정할 수 있다.

- 사용되기 직전에 정의
- 짧은 루프 블록 안으로 한정
- 짧은 if-else 블록 안으로 한정
- 짧은 메서드로 한정

#### 값 변경 최소화하기

변수값이 중간에 계속해서 바뀌면 코드를 분석할 때 해당 변수에 담긴 값을 추적해야 한다는 부담이 생긴다.  

언어가 제공하는 요소의 특성을 잘 활용하면 데이터가 바뀌지 않는다는 것을 명확하게 표현할 수 있다.  
예를 들어 const 나 final 같은 키워드를 사용하면 변수가 바뀌지 않는다는 것을 보장할 수 있다.  
또한 자바의 record 타입이나 코틀린의 데이터 클래스를 사용하면 불변 객체를 쉽게 만들 수 있다.

모든 변수와 객체를 불변으로 만들 필요는 없지만, 로컬 변수나 구조체의 값이 변하지 않아야 코드를 분석할 때  
값을 추적해야 하는 부담을 줄일 수 있다.

파라미터값 변경도 최소화하자.  
파라미터로 전달받은 값을 변경하면 함수를 호출한 코드를 분석할 때 어려움을 겪는다.

#### 알맞은 파라미터 타입 사용하기

파라미터 타입은 필요한 값만 갖는 타입으로 선언해서 사용하자.  
필요한 값만 갖는 타입을 추가하다 보면 만들어야 할 타입이 늘어나고,  
타입이 늘어나면 코드 복잡도도 올라간다.  
새로운 타입을 만들어야 하니 귀찮기도 하다.

하지만 타입을 추가했을 때 올라가는 코드 복잡도보다  
하나의 타입을 여러 메서드의 파라미터 타입으로 사용하면서 늘어나는 코드 분석 시간이 더 큰 문제다.

#### 길지 않은 코드와 메서드 추출

클래스, 메서드, 함수가 길면 머리에 담아야 할 내용이 많아지고 코드 분석은 힘들어진다.  
메서드나 함수를 길지 않게 만들려면 모든 구현을 한 메서드에 넣으면 안되고,  
구현의 일부를 별도 메서드나 객체로 분리해야 한다.

#### 추상화 수준 맞추기

추상화 수준이란 코드를 읽으면서 파악할 수 있는 정보의 수준을 말한다.  
추상화 수준이 들쑥날쑥하면 코드를 분석할 때 개발자가 해석하는 과정을 거쳐야한다.

이해하기 좋은 코드를 만들려면 최대한 한 메서드 내에서 코드가 표현하는 추상화 수준을 맞추려고 노력해야 한다.


