# 아키텍처 • 패턴

주니어 개발자와 중간 • 시니어 개발자를 구분 짓는 요소 중 하나로 아키텍처 설계 역략을 꼽을 수 있다.  
능력있는 시니어 개발자가 되고 싶다면 아키텍처도 신경 써야 한다.

## 아키텍처 고민하기

아키텍처의 정의는 다음과 같다.

> 소프트웨어 아키텍처는 소프트웨어 시스템의 추상적인 구조다.  
> 각 구조는 소프트웨어 요소, 요소간의 관계, 요소화 관계의 속성(프로퍼티) 로 구성된다.

마이크로서비스, MVC(Model-View-Controller), MVP(Model-View-Presenter) 또한 아키텍처이다.

어디까지가 아키텍처이고 어디서부터가 상세 설계에 속하는지 명확하게 구분하기 어렵지만  
확실한 것은 아키텍처가 설계 과정에서 나오는 결과물이라는 것이다.

### 아키텍처를 결정하는 요인

아키텍처를 결정할 때는 크게 2가지를 고려해야 한다.

- 기능 요구 사항
- 품질 속성 또는 비기능 요구 사항

#### 기능 요구 사항

기능 요구 사항은 소프트웨어로 해결하고자 하는 문제와 관련이 있다.  
만들고자 하는 소프트웨어가 모바일 전용 학습 서비스라면 수강 관리, 교육과정 관리, 학습 진도 추적 등 과 같은 요구사항이 존재하는데,  
이런게 기능 요구 사항에 해당한다.

#### 품질 속성

품질 속성은 요구 사항이나, 업무 도메인, 또는 경험에서 도출 된다.
 
요구 사항에서 도출되는 품질 속성은 성능과 확장성 등이 있다.  
보통 요구 사항 문서에 최대 사용자 수, 최대 트래픽 같은 형태로 성능과 확장성을 언급한다.  
수용해야 하는 트래픽 규모와 패턴에 따라 아키텍처도 단순해지거나 복잡해진다.

업무 도메인에서 도출되는 품질 속성의 대표적인 예는 법률 요건이다.  
도메인에 따라 준수해야 하는 법이 존재하고, 이 법을 준수하기 위해 구조에 영향을 주기도 한다.

경험에서 도출되는 품질 속성은 가용성, 인증/인가, 유지보수성 등이 있다.
  
대부분의 온라인 서비스는 24시간 서비스를 제공하기 때문에 요구 사항에 가용성이 포함되어 있지 않더라도 아키텍처를 설계할 때 당연히 가용성을 고려해야 한다.  
또한 인증과 인가도 요구 사항에 포함되어 있지 않더라도 로그인한 사용자가 누구인지 알 수 있어야 하며, 허용한 대상만 특정 기능에 접근 할 수 있어야 한다.

중요한 품질 속성 중 하나가 유지보수성이다.  
성능 같은 속성은 겉으로 잘 드러나는 반면에 유지보수성은 잘 드러나지 않는다.  
하지만 유지보수성이 나쁘면 시스템을 변경하고 개선하는 데 들어가는 비용이 증가하게 되며 결국 서비스의 경쟁력이 떨어지게 된다.  
가용성, 성능, 보안 못지않게 중요한 품질 속성이 바로 유지보수성이다.

### 트레이드오프

품질 속성을 높이면 시스템의 복잡도가 증가한다.  
가용성, 성능, 확장성, 보안, 신뢰성, 유지보수성, 지역화, 연속성등 아키텍처와 관련된 품질 속상은 다양하다.  
모든 품질 속성을 높일 수 있다면 이상적이겠지만 불가능에 가깝다.  
각 품질 속성을 높이면 시스템 복잡도는 배 이상 증가하고, 서로 영향을 주는 품질 속성도 있기 때문이다.  
보통 보안을 높이면 성능은 떨어지고, 가용성이나 성능을 높이면 장비 사용 비용이 증가한다.

푹질 속성을 높이면 복잡도와 비용이 증가하고 서로 상충하는 품질 속성도 존재하기 때문에 아키텍처를 선택할 때 높이고자 하는 품질 속성 간의 절충이 필요하다.  
IT 업계에서 자주 사용되는 말 중 하나인 "그때그때 다르다(It depends on)" 는 아키텍처에도 적용된다.

모든면에서 최고인 아키텍처를 추구하면 안되고, 가장 나쁘지 않은 아키텍처를 선택해야 한다.

### 주요 아키텍처 품질 속성

주요 품질 속성은 다음과 같다.

| 용어                          | 정의                                                                      |
|-----------------------------|-------------------------------------------------------------------------|
| 가용성(Availability)           | 시스템이 얼마나 오랫동안 사용할 수 있는지를 나타내는 속성이다. 99.99%와 같이 사용 가능 시간/전체 시간 비율로 표시한다. |
| 성능(Performance)             | 시스템의 최대 처리량. 평균 응답시간 등을 포함하는 속성이다.                                      |
| 확장성(Scalability)            | 자원을 추가해서 증가한 사용자나 트래픽을 처리할 수 있는 시스템의 속성이다.                              |
| 탄력성(Elasticity)             | 필요에 따라 자원을 추가하거나 반환하는 능력이다.                                             |
| 견고성(Robustness))            | 실행 중에 발생하는 에러나 잘못된 입력을 다루는 능력이다.                                        |
| 결함 허용(Fault tolerance)      | 일부 기능에 장애가 발생해도 시스템이 운영을 지속할 수 있는 능력이다.                                 |
| 신뢰성/안정성(Reliability/safety) | 시스템 고장에 대비한 안전장치가 필요한지 또는 생명에 영향을 주는 중요한 시스템인지를 나타내는 속성이다.              |
| 유지보수성(Maintainability)      | 얼마나 쉽게 시스템을 변경하고 향상할 수 있는지를 나타내는 속성이다.                                  |
| 지역화(Localization)           | 다양한 언어에 대한 지원을 표현하는 속성이다.                                               |
| 테스트 가능성(Testability)        | 소프트웨어 결과물이 주어진 테스트 환경에서 얼마나 테스트할 수 있는지를 나타낸다.                           |
| 합법성(Legal)                  | 시스템이 지켜야 할 법적 규제나 요건을 나타낸다.                                             |
| 보안(Security)                | 데이터베이스에 암호화해서 저장해야 할 데이터, 통신 구간의 암호화 등을 나타내는 속성이다.                      |
| 배포 가능성(Deployability)       | 개발한 결과물을 제품에 쉽게 반영할 수 있는 정도를 표현한다.                                      |
| 추적성(Traceability)           | 무언가를 추적할 수 있는 능력이다.                                                     |

### 아키텍처가 중요한 이유

시스템이 커질수록 전체 시스템 설계가 개별 구현보다 중요해진다.  
어떤 아키텍처를 선택했느냐에 따라 기능 구현에 제약받는 상황이 벌어지기 때문이다.  
아키텍처에 주의를 기울이지 않으면 원하는 품질을 달성하지 못하고 실패할 가능성도 커진다.

적정 소프트웨어 아키텍처 라는 책에서 아키텍처가 중요한 4가지 이유를 언급하고 있다.

- 아키텍처는 시스템의 골격 역할을 한다.
- 아키텍처는 품질 속성에 영향을 미친다.
- 아키텍처는 (대부분) 기능과 직교한다.
- 아키텍처는 시스템을 제한한다.

#### 아키텍처는 시스템의 골격 역할을 한다.

만들려는 시스템에 따라 적합한 아키텍처가 존재한다.  
데이터 일관성이 중요한 API 서버는 트랜잭션 처리가 용이한 아키텍처가,  
채팅 시스템을 위한 서버는 비동기 메시징 처리가 용이한 아키텍처가 적합 할 수 있다.

#### 아키텍처는 품질 속성에 영향을 미친다.

선택한 아키텍처에 따라 높일 수 있는 품질 속성이 있고, 높이기 어려운 품질 속성이 있다.  
마이크로 서비스 아키텍처는 탄력성, 배포 가능성(독립적 배포)이 커지지만 데이터 무결성을 위한 구조는 더 복잡해진다.

#### 아키텍처는 기능과 직교한다.

아키텍처는 품질 속성뿐만 아니라 기능 구현에도 영향을 준다.  
API 서버를 비동기 프레임워크로 구현하면 일부 성능 지표를 높일 수 있지만,  
관리자를 위한 백오피스 기능이나 CPU 연산이 많은 작업에는 적합하지 않다.

#### 아키텍처는 시스템을 제한한다.

인증 • 인가를 위해 어떤 구조를 선택했는지에 따라 관리 할 수 있는 인가 범위가 달라지고,  
가비지 컬렉터를 사용하는 시스템은 가비지 컬렉터가 동작하면서 발생하는 지연 시간을 막을 수 없다.

시스템의 규모가 작으면 아키텍처의 중요성은 상대적으로 떨어지는 반면,  
시스템 규모가 크고 비용이 많이 들거나 위험성이 큰 개발을 할 때는 아키텍처를 신중하게 결정해야한다.

### 아키텍처 변경

아키텍처를 바꾸기 위해 모든걸 다시 개발하기도 한다.  
일명 빅뱅 방식으로, 빅뱅 방식은 최신 장비와 최신 소프트웨어를 사용해서 기존 시스템을 새로 구현하는 것을 말한다.  
이러한 방식은 문제를 야기할 수 있다.

우선, 새 시스템을 만드는 도중에도 기존 시스템에 새 기능이 추가되거나 기존 기능이 변경된다.  
그래서 기존 시스템과 새 시스템간 기능 구현을 지속해서 동기화해야 하는데 이 과정에서 변경된 기능이 누락되기도 한다.  
두번째로 시간이 오래 걸린다.  
시스템은 운영을 거듭하면서 규모가 커지고 복잡해진다.  
기존 시스템을 재개발하려면 기존 시스템을 개발할 때보다 더 많은 인원과 시간이 필요하다.  
기존 로직도 학습해야하는데 코드 분석만으로는 부족하고, 관련자 머릿속에만 있는 로직도 끄집어내야한다.

이러한 이유때문에 일정이 지연되는 경우가 허다하고, 심하면 프로젝트를 접기도 한다.

아키텍처를 변경하는 현실적인 방법은 점진적으로 구조를 변경하는 것이다.  
대표적으로 일부 기능을 서비스로 분리하는 방식이 있다.  
모놀리식 시스템에 존재하는 많은 기능 집합들은 각자 요구하는 품질 속성이 다르다.  
기능 집합을 서비스로 분리하면 해당 서비스에 맞는 품질 속성만 고려해서 설계하면 된다.

또 다른 방법은 동기 연동을 비동기 연동으로 바꾸는 것이다.  
비동기 연동은 각 서비스 간 자율성을 높이고 서비스 간의 영향을 감소시켜줘서 서비스의 독립성을 높여준다.  
비동기 연동을 도입하게 되면 연동하는 서비스에 문제가 생기더라도 영향을 최소화할 수 있다.

아키텍처를 변경하는건 흥미롭지만 단순히 재미 삼아 할 일이 아니다.  
아키텍처 변경은 반드시 필요성에 기반해 이루어져야 한다.  
요구되는 품질 속성의 변화가 없다면 아키텍처를 함부로 변경하면 안된다.  
아키텍처 변경에는 많은 시간과 노력이 따르기 때문에 신중하게 고려해야한다.

아키텍처를 변경하려면 개발비가 들어가고, 성능/가용성/확장성 같은 품질 속성을 높이려면 자연스럽게 구성 요소가 늘어난다.  
구성 요소가 늘어나면 인프라 비용 역시 증가하고, 시스템도 복잡해지고, 그에 따른 운영 부담도 증가한다. 
비용은 증가하고 시스템은 더 복잡해지는데 실질적으로 얻는 이점이 없다면 돈만 낭비한 것에 불과하고,  
복잡도만 높아진 탓에 얻는것 없이 유지보수 비용도 증가한다.  
그러므로 아키텍처를 변경할 때는 확실하게 얻는 이점과 소요될 개발 비용을 고려해야 한다.

## 패턴 익히기

특정 맥락에서 반복되는 문제 해결법을 패턴이라고 부른다.  
상황에 맞는 패턴을 사용하면 설계 시간을 단축할 수 있기에,  
여러가지 설계 패턴을 알고있으면 설계 품질과 유지보수성을 높이는 데 도움이 된다.

#### 아키텍처 패턴

아키텍처 패턴은 아키텍처 수준에서의 패턴을 말한다.  
포트•어댑터 아키텍처, 마이크로서비스 아키텍처, 이벤트 기반 아키텍처 등이 아키텍처 패턴에 속한다.

각 아키텍처 패턴의 장단점이 다르므로 다양한 아키텍처 패턴을 알고있으면 현재 상황에 맞는 아키텍처를 결정할 때 도움이 된다.

이벤트 기반 아키텍처는 탄력성과 성능에 장점이 있지만 트랜잭션 처리가 복잡해지고 테스트가 어려워진다는 단점이 있다.

#### 디자인 패턴

디자인 패턴은 GoF 의 디자인 패턴이 유명하다.  
GoF 디자인 패턴은  
전략(Strategy) 패턴, 커맨드(Command) 패턴, 싱글톤(Singleton) 패턴, 템플릿 메서드(Template Method)패턴, 팩토리 메서드(Factory Method)패턴 등  
개발 과정에서 자주 활용할 수 있는 여러 패턴이 있다.

#### 기업 통합 패턴

기업 통합 패턴은 파일 전송부터 메시징에 이르기까지 시스템 간 통합을 위한 패턴을 말한다.  
최근에는 기업 간 연동뿐 아니라 내부 시스템 간 연동도 증가하는 추세이다.  

#### 결함 허용 패턴

에러 처리에 충분히 신경 쓰면 오류를 줄일 수 있지만 완전히 장애를 없앨 수는 없다.  
따라서 문제를 완전히 없애기보다는 문제가 생겼을 때 알맞게 대처하는 방법을 찾아야 하는데 이때 사용할 수 있는 패턴이 결함 허용 패턴이다.

결함 허용 패턴은 에러 발견, 에러 복구, 에러 완화 등 어떻게 처리할지에 대한 패턴을 포함하는 개념이다.  
하트비트, 재시작, 재시도 제한, 서킷 브레이커 등이 결함 허용과 관련된 패턴이다.

### 패턴이 유용한 이유

- 설계 시간을 단축해준다.
- 원활하게 소통할 수 있게 해준다.

한번에 모든 패턴을 학습할 수는 없지만 주기적으로 새로운 패턴을 익혀보자.


