# 리팩터링 원칙

## 리팩터링 정의

1. [명사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법
2. [동사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

리팩터링은 코드를 이해하고 수정하기 쉽게 만드는 것이다.  
리팩터링은 프로그램의 전반적인 기능을 그대로 유지한다.

## 리팩터링을 하는 이유

1. 소프트웨어 설계 개선
   - 아키텍처를 충분히 이해하지 못한 채 단기 목표만을 위해 코드를 수정하다 보면 기반 구조가 무너진다.
   - 규칙적인 리팩터링을 통해 코드 구조를 개선 할 수 있다.
2. 가독성 향상
   - 코드를 작성 할 때 의도가 명확하게 전달 할 수 있도록 개선할 수 있다.
3. 버그를 찾기 용이
   - 리팩터링을 하면 코드가 하는 일을 깊이 파악하게 되고, 견고한 코드를 작성하는 데 무척 효과적이다.
4. 코드 개발 속도 향상
   - 소프트웨어 내부 품질을 높여서 버그 가능성을 줄이고, 디버깅하기 용이하게 되기 때문에 코드 개발 속도는 향상된다.

## 언제 리팩터링해야 할까?

- 같은 일을 세번 하게 될 때
- 기능을 새로 추가하기 직전
- 버그를 잡을 때
- 코드의 의도를 명확하게 드러내고 싶을 때
- 코드를 검수할 때

### 리팩터링 하면 안되는 상황

- 내부 동작을 이해하지 않아도 될 코드
- 리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때

## 리팩터링 시 고려할 문제

1. 개발 속도 저하
   - 리팩토링의 궁극적인 목적은 개발 속도 향상을 위한 것.
   - 리팩토링을 자주 한다면 코드베이스가 건강해지기 때문에 새 기능을 더 빨리 추가할 수 있다.
2. 코드 소유권
   - 기존 함수를 그대로 유지하고 함수 본문에 새 함수를 호출하도록 수정한 뒤 리팩토링
   - 기존 인터페이스를 폐기 대상으로 지정하고 시간이 흐른 뒤에 삭제(때로는 영원히 남겨야 할 수도 있음)
3. 브랜치
   - 기능별 브랜치가 독립적으로 개발되는 기간이 길어질수록 작업 결과를 마스터로 통합하기 어려워짐
   - 마스터의 코드 베이스를 건강하게 유지
   - 거대한 기능을 잘게 쪼개서 작업
   - 각 기능을 끌 수 있는 기능 토글을 적용하여 완료되지 않은 기능이 시스템을 망치지 않도록 개발
4. 테스팅
   - 리팩토링 전/후 의 동작이 똑같이 유지되는걸 검증하기 위해 자가 테스트 코드가 필요하다.
5. 레거시 코드
   - 테스트가 없다면 테스트를 보강
   - 코드의 한 부분을 훑고 넘어갈 때마다 조금씩 개선
   - 규모가 크다면 자주 보는 부분을 더 많이 리팩터링
6. 데이터베이스
   - 진화형 데이터베이스 설계, 데이터베이스 리팩터링 기법
   - 접근 코드와 데이터베이스 스키마에 대한 구조적 변경을 스크립트로 처리하게끔 통합

## 리팩터링, 아키텍처, 애그니(YAGNI)

현재까지 파악한 요구사항만을 해결하는 소프트웨어를 구축한 뒤  
진행하면서 사용자의 요구사항을 더 잘 이해하게 되면 아키텍처도 그에 맞게 리팩터링한다.

점진적 설계, YAGNI(you aren't going to need it) 방식으로 설계하고,    
거기에 리팩터링이 뒷받침 되어있다면 굉장한 효과를 볼 수 있다.

