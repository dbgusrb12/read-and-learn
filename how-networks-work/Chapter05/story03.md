# 복수 서버에 리퀘스트를 분배한 서버의 부하 분산

## 처리 능력이 부족하면 복수 서버로 부하 분산된다.

서버에 액세스가 증가할 때는 서버로 통하는 회선을 빠르게 하는 방법이 효과적이지만,  
회선을 빠르게 하는 것만으로 부족한 경우도 있다.

고속화한 회선에서 흘러오는 대량의 패킷에 서버의 처리 능력이 따라잡지 못할 수도 있기 때문이다.

이때 해결 방법은 서버 머신을 고성능 기종으로 교체하는 것인데, 다수의 사용자가 집중적으로  
액세스하면 아무리 고성능 기종을 사용해도 따라잡지 못할 수 있다. 그럴때는 복수의 서버를 사용하여  
처리를 분담하는 방법으로 서버 한 대당 처리량을 줄이는 것이 효과적이다.  
이러한 처리 방법을 분산 처리라고 하는데, 처리를 분담하는 방식 역시 여러가지가 있다.

가장 간단한 방법은 웹 서버 여러 대를 설치하고 한 대가 담당하는 사용자 수를 줄이는 방법이 있다.  
N대의 웹서버를 설치하면 한 대가 받는 클라이언트 수는 1/N 로 줄어들기 때문에 부하가 가벼워 진다.

이러한 방법을 취할 경우 클라이언트가 보내는 리퀘스트를 웹 서버에 분배하는 구조가 필요하다.  
가장 간단한 방법은 DNS 서버에서 분배하는 방법으로, DNS 서버에 여러 IP 주소를 등록해놓으면  
조회를 할 때 하나씩 순환하면서 회답을 한다.  
이 방법을 라운드 로빈 이라고 하는데, 이렇게 복수의 서버에 균등하게 액세스를 분산 시킬 수 있다.

라운드 로빈은 고장난 웹 서버가 있어도 상관하지 않고 IP 주소를 회답하기 때문에 문제가 있다.  
또한, CGI 등의 애플리케이션에서 페이지를 만드는 경우 복수의 페이지에 걸쳐 대화 할 수 있는데,  
웹서버가 변하면 대화가 도중에 끊길 수 있다는 문제도 가지고있다.

## 부하 분산 장치를 이용해 복수의 웹 서버로 분할된다.

위의 문제를 피하기 위해 부하 분산 장치, 로드 밸런서 등으로 부르는 기기가 고안되었다.

부하 분산 장치를 사용할 때 먼저 부하 분산 장치를 웹 서버 대신 DNS 서버에 등록하고,  
부하 분산 장치에 리퀘스트 메시지가 도착하면 부하 분산 장치가 웹 서버에 리퀘스트 메시지를 전송한다.

하지만 전후 관계를 알지 못하면 라운드 로빈과 같은 문제점이 생길 수 있기 때문에, 전후 관계를  
판단 하기 위한 정보를 HTTP 헤더 필드에 부가하는 방법 등이 나왔다.

