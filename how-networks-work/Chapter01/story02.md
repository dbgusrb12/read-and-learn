# 웹 서버의 IP 주소를 DNS 서버에 조회한다.

## IP 주소의 기본

인터넷이나 사내 LAN 은 TCP/IP 의 개념에 기초하여 만들어졌다.

TCP/IP 는 서브넷이라는 작은 네트워크를 라우터로 접속하여 전체 네트워크가 만들어진다.  
여기서 말하는 서브넷은, 허브에 몇 대의 PC가 접속된 것을 한 개의 단위로 생각하여 '서브넷' 이라고 부르는데,   
라우터에서 연결하면 네트워크 전체가 완성된다.

여기에 xx동 xx번지 형태로 네트워크 주소를 할당하는데,   
동에 해당하는 번호를 서브넷에 할당하고, 번지에 해당하는 번호를 컴퓨터에 할당한 것이 네트워크의 주소이다.

동에 해당하는 번호를 '네트워크 번호' 라고 하고, 번지에 해당하는 번호를 '호스트 번호' 라고 하며, 이 두 주소가 합쳐져서 `IP 주소` 라고 한다.

브라우저는 URL을 해독하고, HTTP 메시지를 만드는 기능은 있지만, 메시지를 네트워크에 송출하는 기능은 없기 때문에, OS에 의뢰하여 송신한다.


### IP 주소의 표기 방법

실제 IP 주소는 32비트 디지털 데이터이고, 이것을 8비트(1바이트) 씩 점으로 구분하여 10진수로 표기한다.

해당 정보만으로는 어느 부분이 네트워크 번호인지, 호스트 번호인지 알 수 없기 때문에 네트워크를 구축할 때 사용자가 직접 내역을 결정 할 수 있다.  
이 내역을 나타내는 정보를 필요에 따라 IP 주소에 덧붙이는데, 이 정보를 '넷마스크' 라고 한다.

넷마스크는 IP 주소와 같이 32비트이며, IP 주소와 같이 8비트씩 점으로 구분하여 표시하기도 하고, 비트 수를 10진수로 나타내어 표시하기도 한다.

IP 주소 본체의 표기 방법

- `10.11.12.13`

IP 주소 본체와 같은 방법으로 네트워크를 표기하는 방법

- `10.11.12.13/255.255.255.0`
- `10.11.12.13` : IP 주소 본체
- `255.255.255.0` : 넷마스크

네트워크 번호의 비트 수로 넷마스크를 표기하는 방법

- `10.11.12.13/24`
- `10.11.12.13` : IP 주소 본체
- `24` : 넷마스크

서브넷을 나타내는 주소

- `10.11.12.0/24`
- 호스트 번호 부분의 비트가 모두 0인 것은 컴퓨터가 아니라 서브넷 자체를 나타냄

서브넷의 브로드캐스트를 나타내는 주소

- `10.11.12.255/24`
- 호스트 번호 부분의 비트가 모두 1인 것을 서브넷 전체에 대한 브로드캐스트를 나타냄

### 넷마스크로 네트워크 번호와 호스트 번호 구분하는 방법

```
IP 주소 : 10.1.2.3
넷마스크 : 255.255.255.0

IP 주소 : 00001010.00000001.00000010.00000011
넷마스크 : 11111111.11111111.11111111.00000000
        |-------------------------||-------|
                네트워크 번호          호스트 번호

네트워크 번호 : 10.1.2.
호스트 번호 :         3

나란히 나열했을 때 넷마스크가 1인 부분은 네트워크 번호, 넷마스크가 0인 부분은 호스트 번호이다.

```

호스트 번호의 비트 값이 모두 0 또는 1인 경우는 특별한 의미를 가진다.
호스트 번호가 모두 0일 때는 서브넷 자체를 나타내고, 모두 1일 때는 서브넷에 있는 기기 전체에 패킷을 보내는 '브로드캐스트' 를 나타낸다.

## 도메인명과 IP 주소를 구분하여 사용하는 이유

TCP/IP의 네트워크는 IP 주소로 통신 상대를 지정하므로, IP 주소를 모른다면 상대에게 메시지를 전달 할 수 없다.  
그러므로 URL 에는 IP 주소가 아니라 서버의 이름을 쓸 수 있도록 하는게 좋다.

그렇다면 IP 주소를 안쓰고 도메인만 사용하면 안되냐는 의견도 있는데, 실행 효율 관점에서 보면 좋은 방법이 아니다.   
IP 주소는 32비트 지만 도메인 명은 적어도 수십 바이트부터 255 바이트나 있기 때문에 4바이트분의 수치만 취급하면 되는 IP 주소와는 다르게   
많은 양의 문자를 취급해야 하기 때문에 라우터가 부하되어 네트워크 속도가 느려진다.

그래서 라우터는 IP 주소를 사용하고, 사람들은 이름을 사용하는 현재 방법이 정착되어 있다.   
이름을 알면 IP 주소를 알수 있고, IP 주소를 알면 이름을 알 수 있다는 원리를 사용하는데, 그 원리가 `DNS` 이다.

## Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다.

DNS 서버에 조회 메시지를 보내고 거기에 반송되는 응답 메시지를 받는 DNS 클라이언트에 해당하는 것을 DNS 리졸버, 또는 리졸버라고 부른다.

DNS 의 원리를 사용하여 IP 주소를 조사하는 것을 네임 리졸루션(name resolution) 이라고 하는데, 이 리졸루션을 실행하는 것이 리졸버(resolver) 이다.

이 리졸버의 실체는 Socket 라이브러리에 들어있고, 실제로 브라우저에서 리졸버를 사용 할 때는 Socket 라이브러리에 있는 것을 사용한다.   
Socket 라이브러리 속에는 데이터를 송/수신 할 때 사용하는 것을 비롯하여 다양한 프로그램이 존재한다.

## 리졸버를 이용하여 DNS 서버를 조회한다.

리졸버를 호출할 때는 리졸버의 프로그램명(gethostbyname)과 웹 서버의 이름(www.hyungyu.co.kr)을 쓰기만 하면 된다.

이렇게 리졸버를 호출하게 되면, DNS 서버에 조회 메시지를 보내고, 응답 메시지가 돌아온 뒤, 리졸버는 해당 응답 메시지 속에 IP 주소를   
추출하여 브라우저에서 지정한 메모리 영역에 써 넣는다.

브라우저가 웹 서버에 메시지를 보낼 때 이 메모리 영역에서 IP 주소를 추출하여 HTTP 리퀘스트 메시지와 함계 OS에 건너주어 송신을 의뢰한다.

## 리졸버 내부의 작동

1. 네트워크 애플리케이션(브라우저)이 리졸버를 호출
2. 리졸버에서 DNS 서버에 문의하기 위한 메시지 생성 (HTTP 메시지와는 다르게 DNS의 메시지는 바이너리 데이터로 표현한다.)
3. 메시지를 OS의 내부에 포함된 프로토콜 스택을 호출하여 DNS 서버에 전송을 의뢰 (리졸버도 데이터를 송/수신하는 기능이 없기 때문에 OS에 의뢰한다.)
4. DNS 서버에서 응답 메시지를 반송
5. 리졸버가 해당 내용 해독 후 IP 주소를 추출하여 애플리케이션에 건내줌
6. 애플리케이션에서는 건네받은 IP 주소를 사용