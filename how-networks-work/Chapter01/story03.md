# 전 세계의 DNS 서버가 연대한다.

## DNS 서버의 기본 동작

DNS 서버의 기본 동작은 클라이언트에서 조회 메시지를 받고,  
조회의 내용에 응답하는 형태로 정보를 회답하는 일.

### 조회 메시지의 정보

#### 이름

서버나 메일 배송 목적지(메일 주소에서 @ 뒷부분)와 같은 이름이다.

#### 클래스

인터넷 이외의 네트워크에서 이용하는 것을 검토하고 식별하기 위해 존재하는 정보지만,   
현재 인터넷 이외의 네트워크는 소멸되었으므로 클래스의 정보는 항상 'IN' 이라는 값이 된다.

#### 타입

이름에 어떤 타입의 정보가 지원되는지를 나타낸다.   
타입이 A이면 이름에 IP 주소가 지원 되는 것을 나타내고, MX 이면 이름에 메일 배송 목적지가 지원된다.  
이 타입에 따라 클라이언트에 회답하는 정보의 내용이 달라진다.

## 도메인의 계층

전 세계에 있는 막대한 수의 서버가 1대의 DNS 서버에 등록될 수는 없기 때문에,   
해당 DNS 서버에 정보가 등록되어 있지 않은 경우 정보를 분산시켜서 다수의 DNS 서버에 등록하고,   
다수의 DNS 서버가 연대하여 어디에 정보가 등록되어 있는지 찾아내는 구조를 가진다.

DNS 서버에 등록한 정보에는 도메인명이라는 계층적 구조를 가진 이름이 붙여져 있는데,   
계층을 구분하는 기준은 점(`.`)이다.

`www.hyungyu.co.kr` 을 예로 들면,  
`kr` 이라는 도메인 아래에 `co` 라는 도메인이 있고,   
그 아래에 `hyungyu`, 그 아래에 `www` 라는 이름이 있는 것이다.

## 담당 DNS 서버를 찾아 IP 주소를 가져온다.

전 세계의 DNS 서버를 모두 뒤지면서 도메인을 찾을 수는 없기 때문에,  
하위 도메인을 담당하는 DNS 서버의 주소를 그 상위의 DNS 서버에 등록을 한다.

그렇게 되면 상위의 DNS 서버에서 하위 DNS 서버의 주소를 알 수 있고, 메시지를 보낼 수 있다.

`com` 이나 `kr` 이라는 도메인을 최상위 도메인이라고 하는데,  
이 최상위 도메인 상위에 루트 도메인이라는 것이 존재한다.

루트 도메인은 보통 생략하지만, 명시적으로 작성해 줘야 하는 경우에는 끝에 마침표를 찍어 나타낸다.
`www.hyungyu.co.kr.`

그렇게 해서 루트 도메인까지 올라가 하위 DNS 서버를 등록 한 뒤, 루트 도메인의 DNS 서버를 인터넷에   
존재하는 모든 DNS 서버에 등록을 해야 한다.

그러면 해당 DNS 서버로 부터 루트 도메인의 DNS 서버를 액세스 한 뒤,   
하위 도메인 까지 쭉 조회를 할 수 있게 되는것이다.

`www.hyungyu.co.kr` 이라는 도메인을 클라이언트 PC 에서 조회 하는 과정을 보면, 
1. 클라이언트 PC 에서 가장 가까운 DNS 서버에 요청을 보낸다.
2. 가장 가까운 DNS 서버에서 루트 도메인의 DNS 서버로 요청을 보내고, 하위 도메인이 등록되어있는 DNS 서버의 주소를 응답받는다.
3. 응답받은 DNS 서버의 주소에 요청을 보내고, 하위 도메인이 등록되어 있는 DNS 서버의 주소를 응답 받는다.
4. 3의 과정을 계속 거친 뒤, 도메인에 해당하는 IP 주소를 받아 온 뒤 클라이언트 PC 에 전달한다.
5. 클라이언트 PC 에서 해당 IP 주소에 액세스 한다.

## DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다.

DNS 서버에서는 한번 조사한 이름을 캐시에 기록 할 수 있기 때문에, 조회한 이름에 해당하는 정보가 캐시에  
있다면, 해당 정보를 회답하기 때문에, 위의 순서가 꼭 맞지는 않을 수도 있다.

조회한 이름이 도메인에 등록되어 있지 않은 경우엔 이름이 존재하지 않는다는 회답이 돌아오고,   
이 정보 마저 캐시에 보존 할 수 있으며, 빠르게 회답할 수 있다.

그렇기 때문에 빠르다는 장점이 있지만, 현재 시점의 캐시가 꼭 올바르다고 단언 할 수는 없다는 단점이 있다.