# IP 와 이더넷의 패킷 송/수신 동작

## 패킷의 기본

TCP 담당 부분은 접속, 송/수신, 연결 끊기의 단계에서 통신 상대와 대화 할 때 IP 담당 부분에  
의뢰하여 대화하는 데이터를 패킷의 모습으로 만들어 상대에게 도착한다.

패킷은 `헤더` 와 `데이터` 두 부분으로 구성되는데,  
헤더에는 수신처를 나타내는 주소 등의 제어 정보가 들어있고,  
데이터에는 의뢰처에서 의뢰한 데이터가 들어있다.

### 패킷의 기본형
```
| 헤더 | 데이터 (내용) |
```
패킷의 맨 앞에 제어 정보가 담긴 헤더가 있고,  
패킷으로 운반하는 데이터가 뒤에 들어간다.

### TCP/IP의 패킷
```
|-----------이더넷의 패킷------------------|
          |--------IP의 패킷-------------|
| MAC 헤더 | IP 헤더 | TCP 헤더 | 데이터 조각 |
```
MAC 헤더 : 이더넷의 제어 정보  
IP 헤더 : IP 의 제어 정보  
TCP 헤더 : TCP 의 제어 정보  
데이터 조각 : 실제 보내는 데이터의 내용  

보통 TCP 헤더와 데이터 조각이 패킷의 내용이 된다.

### 패킷의 이동 과정

패킷은 송신처가 되는 기기가 만드는데, 헤더에 적절한 제어 정보를 기록하고,  
데이터 부분에 얼마간의 데이터를 넣은 후 패킷을 가장 가까운 중계 장치에 보낸다.  
가까운 중계 장치에서는 도착한 패킷의 헤더를 조사하여 패킷의 목적지를 판단하는데,  
이 때 사용하는게 어느 수신처가 어느 방향에 있는지에 대한 정보를 기록한 표와 같은 것이다.

패킷의 헤더에 기록되어 있는 수신처와 표에 등록된 내용을 결합하여 패킷의 수신처가 어느 케이블로  
가야 도착 할 수 있는지 판단 할 수 있고, 해당 케이블로 패킷을 송신한다.  
이 방법으로 계속해서 패킷을 중계하다보면 최종적으로 수신처의 기기에 패킷이 도착하는 것이다.

패킷의 이동은 송신처에서 수신처로 이동하는데, 회답할때는 송신처와 수신처가 뒤바뀌기 때문에,  
송신처와 수신처를 명확하게 구분하지 않는 쪽이 편리하다.  
그리고 이러한 경우 송신처와 수신처의 기기를 묶어서 `엔드 노드` 라고 부른다.

TCP/IP 네트워크에서는 서브넷이라는 작은 네트워크를 만들어 사용하는데,  
서브넷은 `라우터` 와 `허브` 라는 두 종류의 패킷 중계 장치를 사용하여 각각의 역할을 분담하면서  
패킷을 운반하기 때문에 위에서 설명한 패킷의 기본보다 좀 더 복잡하다.

기본적으로 라우터는 목적지를 확인하여 다음 라우터를 나타내고,  
허브는 서브넷 안에서 패킷을 운반하여 다음 라우터에 도착하는 역할을 한다.

즉, 허브는 이더넷의 규칙에 따라 패킷을 운반하고, 라우터는 IP의 규칙에 따라 패킷을 운반하는 것이다.  

위의 내용을 바꾸어 말하면,  

IP는 목적지를 확인하여 다음 IP의 중계 장치를 나타내고,  
서브넷 안에 있는 이더넷이 중계 장치까지 패킷을 운반하는 역할을 한다.

라고 할 수 있고, 좀 더 구체적으로 말하면 라우터에서 관리하는 MAC 헤더(이더넷용 헤더) 와  
허브에서 관리하는 IP 헤더(IP용 헤더) 가 패킷에 붙어있는 것이다.
