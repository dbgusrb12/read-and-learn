# 서버에서 연결을 끊어 소켓을 말소한다.

## 데이터 보내기를 완료했을 때 연결을 끊는다.

데이터 송/수신을 종료하는 것은 애플리케이션이 송신해야 하는 데이터를 전부 송신 완료했다고 판단했을 때이다.

그 때 송신을 완료한 측이 연결 끊기 단계로 들어가는데,  
어디에서 데이터 송/수신 동작이 끝나는지는 애플리케이션에 따라 다르다.

웹에서는 서버에서 연결 끊기 단계로 들어가는 상황이 많기 때문에, 서버측을 기준으로 설명하면,  
서버측의 애플리케이션이 Socket 라이브러리의 `close` 를 호출한다.  
그러면 서버측 프로토콜 스택이 TCP 헤더를 만들고, 여기에 연결 끊기를 나타내는 정보를 설정한다.

구체적으로는 컨트롤 비트의 FIN 비트에 1을 설정하고, IP 담당 부분에 의뢰하여 클라이언트에 송신해 달라고  
요청하고, 서버측 소켓에 연결 끊기 동작에 들어갔다는 정보를 기록한다.

클라이언트 측에서는 서버에서 FIN 이 1인 TCP 헤더가 도착하면 자신의 소켓에 서버측이 연결 끊기 동작에  
들어갔다는 것을 기록한 뒤, FIN 을 1로 받았다는 사실을 알리기 위해 ACK 번호로 서버측에 반송한다.  

잠시 후 애플리케이션이 `read` 를 호출하여 데이터를 가지러 올 때, 데이터를 바로 건네지 않고 서버에서  
보낸 데이터를 전부 수신 완료했다는 사실을 클라이언트측 애플리케이션에 알린다.

웹은 서버가 응답을 반송하면 끝나도록 규칙으로 정해져있기 때문에 서버에서 보낸 데이터를 전부 수신 완료하면  
클라이언트도 종료한다.  
그래서 클라이언트측 애플리케이션도 `close`를 호출하여 데이터 송/수신 동작을 끝낸다.

그 때 클라이언트측의 프로토콜 스택은 서버측과 마찬가지로 FIN 비트에 1을 설정한 TCP 헤더를 만들고 IP 담당  
부분에 의뢰하여 서버에 송신 한 후 서버에서 ACK 번호가 돌아오면 종료된다.

## 소켓을 말소한다.