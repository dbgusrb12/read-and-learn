# 소켓을 작성한다.

## 프로토콜 스택의 내부 구성

프로토콜 스택의 내부는 역할이 서로 다른 몇 부분으로 나뉘어져 있다.

애플리케이션, OS, 드라이버 소프트웨어, 하드웨어로 구성되어 있다.

### 애플리케이션

애플리케이션 단에는 네트워크 애플리케이션, Socket 라이브러리가 있는데,   

네트워크 애플리케이션의 종류는 브라우저, 메일러, 웹 서버, 메일 서버등의 프로그램이 있다.

애플리케이션 아래부분에는 Socket 라이브러리가 있고, 이전에 설명 했던 리졸버가 내장되어 있다.

### OS

OS 단에는 프로토콜 스택이 존재하며,   
프로토콜 스택의 윗부분에는 데이터 송/수신을 담당하는 TCP, UDP 라는 프로토콜이 있고,  
아래 부분에는 패킷 송/수신 동작을 제어하는 IP 프로토콜이 있다.
 
브라우저나 메일 등의 일반적인 애플리케이션에서 데이터를 송/수신 하는 경우 TCP를 사용하고,   
DNS 서버에 대한 조회 등에서 짧은 제어용 데이터를 송/수신 하는 경우 UDP 를 사용한다.

인터넷에서 데이터를 운반할 때는 데이터를 작게 나누어 패킷이라는 형태로 운반하는데,  
이 패킷을 통신 상대까지 운반하는 것이 IP 프로토콜의 주 역할이다.

IP 프로토콜 내부에는 ICMP 와 ARP 라는 프로토콜을 다루는 부분이 포함되어 있는데,   
ICMP 는 패킷을 운반할 때 발생하는 오류를 통지하거나 제어용 메시지를 통지할 때,   
ARP 는 IP 주소에 대응하는 이더넷의 MAC 주소를 조사할 때 사용한다.

### 드라이버 소프트웨어

드라이버 소프트웨어 단에는 LAN 드라이버가 존재하고,   
LAN 드라이버의 역할은 LAN 어댑터의 하드웨어를 제어한다.

### 하드웨어

하드웨어 단에는 LAN 어댑터가 존재하고,   
LAN 어댑터는 실제 송/수신 동작, 즉 케이블에 대해 신호를 송/수신 하는 동작을 실행한다.

## 소켓의 실체는 통신 제어용 제어 정보

프로토콜 스택은 내부에 제어 정보를 기록하는 메모리 영역을 가지고 있으며,   
해당 메모리 영역에 통신 동작을 제어하기 위한 제어 정보를 기록한다.

제어 정보의 대표적인 예로는 통신 상대의 IP 주소, 포트 번호, 통신 동작의 진행 상태 등이 있다.

소켓이란 개념적인 것이어서 굳이 말하면 이 제어 정보, 또는 제어 정보를 기록한 메모리 영역이 소켓의 실체라고 할 수 있다.

프로토콜 스택은 이 소켓에 기록된 제어 정보를 기반으로 동작한다.

## Socket 을 호출했을 때의 동작

`socket` 을 호출하여 소켓을 만들 때,  
프로토콜 스택은 소켓 한 개 분량의 메모리 영역을 확보하고,  
해당 메모리에 초기 상태임을 나타내는 제어 정보를 기록한다.

소켓이 생성되면, 소켓을 나타내는 디스크립터를 애플리케이션에 알려준다.
그 후 애플리케이션이 프로토콜 스택에 데이터 송/수신 동작을 의뢰 할 때 해당 디스크립터를  
통지한다.

소켓에는 누구와 누가 통신하고 있는지, 어떤 상태로 있는지 등의 정보가 전부 기록되어 있으므로  
디스크립터가 어느 소켓인지 나타내면 필요한 정보는 전부 프로토콜 스택에서 알 수 있다.
